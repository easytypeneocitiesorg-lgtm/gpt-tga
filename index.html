<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Untrained Image Generator</title>
<style>
  body {
    margin: 0;
    padding: 20px;
    background: #0b0b0b;
    color: #fff;
    font-family: system-ui, sans-serif;
  }

  input, button {
    background: #111;
    color: #fff;
    border: 1px solid #333;
    padding: 10px;
  }

  button {
    cursor: pointer;
  }

  .row {
    display: flex;
    gap: 20px;
    margin-top: 20px;
  }

  textarea {
    width: 100%;
    height: 512px;
    background: #111;
    color: #0f0;
    border: 1px solid #333;
    font-family: monospace;
    font-size: 12px;
    resize: none;
    overflow: auto;
  }
</style>
</head>
<body>

<h1>untrained image generator</h1>
<p>no model. no training. just vibes.</p>

<input id="prompt" placeholder="type anything" style="width:100%;margin-bottom:10px;">
<button onclick="generate()">generate</button>

<div class="row">
  <canvas id="canvas" width="512" height="512" style="border:1px solid #222;"></canvas>

  <div style="flex:1;">
    <div style="margin-bottom:6px;">
      raw .tga data
      <button onclick="copyRaw()" style="margin-left:10px;padding:4px 8px;">copy</button>
      <button onclick="openRaw()" style="margin-left:6px;padding:4px 8px;">open data in new tab</button>
    </div>
    <textarea id="raw" readonly></textarea>
  </div>
</div>

<script>
function hashString(str) {
  let h = 2166136261;
  for (let i = 0; i < str.length; i++) {
    h ^= str.charCodeAt(i);
    h = Math.imul(h, 16777619);
  }
  return h >>> 0;
}

function mulberry32(seed) {
  return function () {
    let t = (seed += 0x6D2B79F5);
    t = Math.imul(t ^ (t >>> 15), t | 1);
    t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
  };
}

function canvasToTGA(ctx, w, h) {
  const img = ctx.getImageData(0, 0, w, h).data;

  const header = new Uint8Array(18);
  header[2] = 2;
  header[12] = w & 255;
  header[13] = (w >> 8) & 255;
  header[14] = h & 255;
  header[15] = (h >> 8) & 255;
  header[16] = 24;

  const pixels = new Uint8Array(w * h * 3);
  let p = 0;

  for (let y = h - 1; y >= 0; y--) {
    for (let x = 0; x < w; x++) {
      const i = (y * w + x) * 4;
      pixels[p++] = img[i + 2];
      pixels[p++] = img[i + 1];
      pixels[p++] = img[i];
    }
  }

  const out = new Uint8Array(header.length + pixels.length);
  out.set(header, 0);
  out.set(pixels, header.length);
  return out;
}

function bytesToHex(bytes) {
  let s = "";
  for (let i = 0; i < bytes.length; i++) {
    s += bytes[i].toString(16).padStart(2, "0") + " ";
    if ((i + 1) % 16 === 0) s += "\n";
  }
  return s.trim();
}

function generate() {
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");
  const prompt = document.getElementById("prompt").value;

  const seed = hashString(prompt || Math.random().toString());
  const rand = mulberry32(seed);

  const w = canvas.width;
  const h = canvas.height;

  ctx.fillStyle = `hsl(${rand() * 360},40%,10%)`;
  ctx.fillRect(0, 0, w, h);

  for (let i = 0; i < 400; i++) {
    ctx.beginPath();
    ctx.arc(rand() * w, rand() * h, rand() * 120, 0, Math.PI * 2);
    ctx.fillStyle = `hsla(${rand() * 360},${40 + rand() * 60}%,${30 + rand() * 40}%,0.08)`;
    ctx.fill();
  }

  for (let i = 0; i < 120; i++) {
    ctx.beginPath();
    ctx.moveTo(rand() * w, rand() * h);
    ctx.bezierCurveTo(
      rand() * w, rand() * h,
      rand() * w, rand() * h,
      rand() * w, rand() * h
    );
    ctx.strokeStyle = `hsla(${rand() * 360},80%,60%,0.15)`;
    ctx.lineWidth = rand() * 2;
    ctx.stroke();
  }

  const tga = canvasToTGA(ctx, w, h);
  document.getElementById("raw").value = bytesToHex(tga);
}

function copyRaw() {
  navigator.clipboard.writeText(
    document.getElementById("raw").value
  );
}

function openRaw() {
  const data = document.getElementById("raw").value;

  const blob = new Blob([data], { type: "text/plain" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.target = "_blank";
  a.rel = "noopener";

  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);

  // optional cleanup later
  setTimeout(() => URL.revokeObjectURL(url), 60000);
}
</script>

</body>
</html>
